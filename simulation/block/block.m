clear all; clc;
global global_info;

global_info.STOP_AT = 500;

% full list of coloured tokens, seperated for each boarding group
colourRotation2 = {'A','B','C','D' ...
    'A','B','C','D' ...
    'A','B','C','D' ...
    'Z','Y','X','W' ...
    'Z','Y','X','W' ...
    'Z','Y','X','W'};
colourRotation3 = {'E','F','G','H' ...
    'E','F','G','H' ...
    'E','F','G','H' ...
    'V','U','T','S' ... 
    'V','U','T','S' ...
    'V','U','T','S'};
colourRotation1 = {'I','J','K','L' ...
    'I','J','K','L' ...
    'I','J','K','L' ...
    'R','Q','P','O' ...
    'R','Q','P','O' ...
    'R','Q','P','O'};

% set the colour rotation to be random
global_info.cr1 = colourRotation1(randperm(numel(colourRotation1)));
global_info.cr2 = colourRotation2(randperm(numel(colourRotation2)));
global_info.cr3 = colourRotation3(randperm(numel(colourRotation3)));

% colour rotation index
global_info.cr_index = 0;
% count the number of tokens sent through transition and mark the current
% boarding group being processed
global_info.boarded = 0;

global_info.currentGroup = 1;

pns = pnstruct('block_pn_pdf');

% block the init(s)
global_info.init = 1;
% the aisle blocking variables (1=open, 0=blocked)
global_info.A01 = 1;
global_info.A02 = 1;
global_info.A03 = 1;
global_info.A04 = 1;
global_info.A05 = 1;
global_info.A06 = 1;
global_info.A07 = 1;
global_info.A08 = 1;
global_info.A09 = 1;
global_info.A10 = 1;
global_info.A11 = 1;
global_info.A12 = 1;

% total token count (2 columns x 3 seats x 12 rows)
dyn.m0 = {'pStart', 72};
% firing times, Have been tweaked to attempt to closely match the pre-existing results
% from the paper by Jason Steffen and Jon Hotchkiss
dyn.ft = {'tL01',10.5,'tL02',10.5,'tL03',10.5,'tL04',10.5,'tL05',10.5,'tL06',10.5, ...
    'tL07',10.5,'tL08',10.5,'tL09',10.5,'tL10',10.5,'tL11',10.5,'tL12',10.5, ...
    'tR01',10.5,'tR02',10.5,'tR03',10.5,'tR04',10.5,'tR05',10.5,'tR06',10.5, ...
    'tR07',10.5,'tR08',10.5,'tR09',10.5,'tR10',10.5,'tR11',10.5,'tR12',10.5, ...
    'allothers', 0.5};
% transition priority, prioritise side ones to make sure colours go down
% their pathway
dyn.ip = {'tL01',1,'tL02',1,'tL03',1,'tL04',1,'tL05',1,'tL06',1, ...
    'tL07',1,'tL08',1,'tL09',1,'tL10',1,'tL11',1,'tL12',1, ...
    'tR01',1,'tR02',1,'tR03',1,'tR04',1,'tR05',1,'tR06',1, ...
    'tR07',1,'tR08',1,'tR09',1,'tR10',1,'tR11',1,'tR12',1
};

pni = initialdynamics(pns, dyn);

sim = gpensim(pni);

% the whole model
plotp(sim, { ...
    'pL01','pA01','pR01', ...
    'pL02','pA02','pR02', ...
    'pL03','pA03','pR03', ...
    'pL04','pA04','pR04', ...
    'pL05','pA05','pR05', ...
    'pL06','pA06','pR06', ...
    'pL07','pA07','pR07', ...
    'pL08','pA08','pR08', ...
    'pL09','pA09','pR09', ...
    'pL10','pA10','pR10', ...
    'pL11','pA11','pR11', ...
    'pL12','pA12','pR12'
});

%{
% only the aisle
figure
plotp(sim, {'pA00' ...
    'pA01','pA02','pA03', 'pA04','pA05','pA06' ...
    'pA07','pA08','pA09','pA10','pA11','pA12'
});
%}

% Group 1
figure
plotp(sim, { ...
    'pL09','pR09' ...
    'pL10','pR10' ...
    'pL11','pR11' ...
    'pL12','pR12'
});

% Group 2
figure
plotp(sim, { ...
    'pL01','pR01' ...
    'pL02','pR02' ...
    'pL03','pR03' ...
    'pL04','pR04'
});

% Group 3
figure
plotp(sim, { ...
    'pL05','pR05' ...
    'pL06','pR06' ...
    'pL07','pR07' ...
    'pL08','pR08'
});

prnss(sim);
%prncolormap(sim);
%prnfinalcolors(sim);
